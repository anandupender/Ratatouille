<!doctype html>
<html ng-app="cs142App" ng-controller="MainController">
    <head>

        <title>{{main.title || "Ratatouille"}}</title>

        <link href="./node_modules/angular-material/angular-material.css" rel="stylesheet" />
        <link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css">
    
        <script src="./node_modules/angular/angular.js" type="text/javascript" ></script>
        <script src="./node_modules/angular-animate/angular-animate.js" type="text/javascript" ></script>
        <script src="./node_modules/angular-aria/angular-aria.js" type="text/javascript" ></script>
        <script src="./node_modules/angular-material/angular-material.js" type="text/javascript" ></script>

        <script src="node_modules/angular-route/angular-route.js"></script>

        <script src="mainController.js"></script>
        <link rel="stylesheet" type="text/css" href="main.css" />

        <script src="components/recipe-list/recipe-listController.js"></script>
        <link rel="stylesheet" type="text/css" href="components/recipe-list/recipe-list.css" />

        <script src="components/recipe-detail/recipe-detailController.js"></script>
        <link rel="stylesheet" type="text/css" href="components/recipe-detail/recipe-detail.css" />

        <script src="components/recipe-photos/recipe-photosController.js"></script>
        <link rel="stylesheet" type="text/css" href="components/recipe-photos/recipe-photos.css" />

        <script src="./modelData/recipeApp.js"></script>
        <meta content="width=device-width, initial-scale=0.9, maximum-scale=0.9" name="viewport">
        <title>Ratatouille App</title>


        <link rel="stylesheet" type="text/css" href="main.css" />
        <script language="javascript" type="text/javascript" src="ady.js"></script>
        <script language="javascript" type="text/javascript" src="https://code.jquery.com/jquery-2.1.4.min.js"></script>

        <script>
            $(document).bind('mobileinit',function(){
                $.mobile.pushStateEnabled = false;
            });
        </script>
<!--         <script language="javascript" type="text/javascript" src="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>
 -->        
        <meta charset="UTF-8">
        <script>
            // var connection = new WebSocket('ws://'+location.hostname+':81/', ['arduino']);
            var connection = new WebSocket('ws://websocketstest.local:81/', ['arduino']);
            connection.onopen = function () {  connection.send('Connect ' + new Date()); }; 
            connection.onerror = function (error) {    console.log('WebSocket Error ', error);};
            connection.onmessage = function (e) {  
                console.log('Server: ', e.data);

                if(e.data[2] === "T"){  //TEMP
                    console.log("Reading in Temp");
                    var temp = e.data;
                    temp = temp.slice(15,-1); //remove beginning
                    console.log('Server (parsed): ', temp);
                    var scope = angular.element($("#outer")).scope();
                    var controllerElement = document.querySelector('html');
                    var $scope = angular.element(controllerElement).scope();
                    $scope.$apply(function(){
                        $scope.main.currTemp = temp;
                        console.log($scope.main.currTemp);
                    })
                }
            };
            connection.onclose = function(e) {
                console.log('Server: ', e.data);
                $('#SystemStatusClicker').css("color", "red" );
                IssueSystemMessage( "WebSocket Disconnected!" );
             };
            function LaserToggle(){
                var OnOff = document.getElementById('flipper').value;  
                if(OnOff === "on"){
                    OnOff = "*1";
                }
                else if(OnOff === "off"){
                    OnOff = "*0";
                }
                console.log('OnOff: ' + OnOff); 
                connection.send(OnOff);
            }
        </script>
    </head>

    <body layout="column">

        <md-toolbar layout = "row">
            <h2 flex>Ratatouille App</h2>

        </md-toolbar>

        <div class="container" flex layout="row">

            <md-sidenav md-is-locked-open="true" class="md-whiteframe-z2">
                <div ng-include="'components/recipe-list/recipe-listTemplate.html'" ng-controller="RecipeListController"></div>
            </md-sidenav>

            <md-content flex id="content">
                <div ng-view></div>
                <label for="flipper"><h2>Adjust Temp Sensor (laser)</h2></label>
                <select name="slider" id="flipper" data-role="slider" onchange="LaserToggle();">
                    <option value="off">Off</option>
                    <option value="on">On</option>
                </select> 

            </md-content>

        </div>

    </body>
</html>
